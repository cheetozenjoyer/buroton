From be217799e9dbb9e21bc623dfe78247bb0560ebf5 Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Sun, 15 Feb 2026 00:19:49 +0100
Subject: [PATCH 3/6] wdfldr.sys: Populate function table for
 WdfDriverMiniportUnload.

Co-authored-by: Quitting <quitthefake@gmail.com>
---
 dlls/wdfldr.sys/wdfldr_main.c | 17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/dlls/wdfldr.sys/wdfldr_main.c b/dlls/wdfldr.sys/wdfldr_main.c
index dd370237ed6..b50e81cee0c 100644
--- a/dlls/wdfldr.sys/wdfldr_main.c
+++ b/dlls/wdfldr.sys/wdfldr_main.c
@@ -89,6 +89,12 @@ static WDFLDR_CLIENT_INFO *find_client_info(DRIVER_OBJECT *driver)
     return NULL;
 }
 
+/* stub for WdfDriverMiniportUnload (idx 201) */
+static void WINAPI wdf_stub_void_noop(void *arg)
+{
+    TRACE("stub called with %p\n", arg);
+}
+
 NTSTATUS WINAPI WdfVersionBind(DRIVER_OBJECT *driver, UNICODE_STRING *reg_path, 
                                 WDF_BIND_INFO *bind_info, PWDF_COMPONENT_GLOBALS *component_globals)
 {
@@ -145,7 +151,16 @@ NTSTATUS WINAPI WdfVersionBind(DRIVER_OBJECT *driver, UNICODE_STRING *reg_path,
             goto done;
         }
         
-        /* fixme: actually populate the function table (?) */
+        /* populate index 201 (WdfDriverMiniportUnload) */
+        if (bind_info->FuncCount > 201)
+        {
+            ((void**)client_info->func_table)[201] = wdf_stub_void_noop;
+        }
+    }
+
+    if (bind_info->FuncTable)
+    {
+        *bind_info->FuncTable = client_info->func_table;
     }
 
     client_info->globals.Size = sizeof(WDF_COMPONENT_GLOBALS);
-- 
2.53.0

