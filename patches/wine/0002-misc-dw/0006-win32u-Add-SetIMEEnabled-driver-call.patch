From e07073d48f5deff7e983b89f29c9d26741b2f63c Mon Sep 17 00:00:00 2001
From: Ziia Shi <mkrsym1@gmail.com>
Date: Sun, 1 Feb 2026 01:54:17 +0100
Subject: [PATCH 06/12] win32u: Add SetIMEEnabled driver call.

---
 dlls/win32u/driver.c      | 12 ++++++++++++
 include/wine/gdi_driver.h |  3 ++-
 2 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/dlls/win32u/driver.c b/dlls/win32u/driver.c
index 231b223a463..5eaddc7ba49 100644
--- a/dlls/win32u/driver.c
+++ b/dlls/win32u/driver.c
@@ -691,6 +691,11 @@ static BOOL nulldrv_SetIMECompositionRect( HWND hwnd, RECT rect )
     return FALSE;
 }
 
+static BOOL nulldrv_SetIMEEnabled( HWND hwnd, BOOL enabled )
+{
+    return FALSE;
+}
+
 static LRESULT nulldrv_DesktopWindowProc( HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam )
 {
     return default_window_proc( hwnd, msg, wparam, lparam, FALSE );
@@ -1119,6 +1124,11 @@ static BOOL loaderdrv_SetIMECompositionRect( HWND hwnd, RECT rect )
     return load_driver()->pSetIMECompositionRect( hwnd, rect );
 }
 
+static BOOL loaderdrv_SetIMEEnabled( HWND hwnd, BOOL enabled )
+{
+    return load_driver()->pSetIMEEnabled( hwnd, enabled );
+}
+
 static LONG loaderdrv_ChangeDisplaySettings( LPDEVMODEW displays, LPCWSTR primary_name, HWND hwnd,
                                              DWORD flags, LPVOID lparam )
 {
@@ -1259,6 +1269,7 @@ static const struct user_driver_funcs lazy_load_driver =
     loaderdrv_ImeProcessKey,
     loaderdrv_NotifyIMEStatus,
     loaderdrv_SetIMECompositionRect,
+    loaderdrv_SetIMEEnabled,
     /* cursor/icon functions */
     nulldrv_DestroyCursorIcon,
     loaderdrv_SetCursor,
@@ -1362,6 +1373,7 @@ void __wine_set_user_driver( const struct user_driver_funcs *funcs, UINT version
     SET_USER_FUNC(ImeProcessKey);
     SET_USER_FUNC(NotifyIMEStatus);
     SET_USER_FUNC(SetIMECompositionRect);
+    SET_USER_FUNC(SetIMEEnabled);
     SET_USER_FUNC(DestroyCursorIcon);
     SET_USER_FUNC(SetCursor);
     SET_USER_FUNC(GetCursorPos);
diff --git a/include/wine/gdi_driver.h b/include/wine/gdi_driver.h
index e29eccb9bd3..89023466ce3 100644
--- a/include/wine/gdi_driver.h
+++ b/include/wine/gdi_driver.h
@@ -221,7 +221,7 @@ struct gdi_dc_funcs
 };
 
 /* increment this when you change the DC function table */
-#define WINE_GDI_DRIVER_VERSION 102
+#define WINE_GDI_DRIVER_VERSION 103
 
 #define GDI_PRIORITY_NULL_DRV        0  /* null driver */
 #define GDI_PRIORITY_FONT_DRV      100  /* any font driver */
@@ -345,6 +345,7 @@ struct user_driver_funcs
     UINT    (*pImeProcessKey)(HIMC,UINT,UINT,const BYTE*);
     void    (*pNotifyIMEStatus)(HWND,UINT);
     BOOL    (*pSetIMECompositionRect)(HWND,RECT);
+    BOOL    (*pSetIMEEnabled)(HWND,BOOL);
     /* cursor/icon functions */
     void    (*pDestroyCursorIcon)(HCURSOR);
     void    (*pSetCursor)(HWND,HCURSOR);
-- 
2.53.0

